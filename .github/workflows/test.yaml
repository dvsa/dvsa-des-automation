name: Run App Automation [develop]
run-name: "${{ github.actor }} - ${{ github.ref_name }} - ${{ github.run_id }} ğŸš€"
on: [push]
jobs:
  test:
    name: Run DES Automation
    runs-on: mito-2
    steps:
      - name: ğŸ“¨ Get Codebase
        uses: actions/checkout@v3
        with:
          ref: develop

      - name: Configure Node
        uses: actions/setup-node@v3
        with: 
          node-version: '16.11.0'
      
      - name: âš™ï¸ Configure Files
        run: |
          echo "${{ secrets.NPMRC }}" | base64 --decode >> .npmrc
          mkdir creds apps
          cp -r /Users/jenkins/GHA-TEST/App.app apps/
          echo "${{ secrets.CREDS_JSON }}" | base64 --decode > creds/credentials.json

      - name: ğŸ› ï¸ Install Dependencies
        run: npm ci

      - name: ğŸ§ª Run Tests
        run: npm run wdio:des:ap:report

      - name: ğŸ› ï¸ Generate Reports
        run: npm run s3report

      - name: "ğŸ“ Generate Report"
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: des-report-${{ github.run_id }}
          path: reports
          retention-days: 3
