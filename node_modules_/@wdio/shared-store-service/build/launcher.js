"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const logger_1 = __importDefault(require("@wdio/logger"));
const utils_1 = require("./utils");
const client_1 = require("./client");
const log = (0, logger_1.default)('@wdio/shared-store-service');
let server;
class SharedStoreLauncher {
    constructor() {
        // current process pid
        this.pidFile = (0, utils_1.getPidPath)(process.pid);
    }
    async onPrepare() {
        server = require('./server').default;
        const result = await server.startServer();
        (0, client_1.setPort)(result.port);
        log.info(`Started shared server on port ${result.port}`);
        await (0, utils_1.writeFile)(this.pidFile, result.port.toString());
    }
    async onComplete() {
        await server.stopServer();
        await (0, utils_1.deleteFile)(this.pidFile);
    }
}
exports.default = SharedStoreLauncher;
