"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const utils_1 = require("./utils");
const client_1 = require("./client");
class SharedStoreService {
    async beforeSession() {
        /**
         * get port from parent's pid file saved in `onPrepare` hook
         */
        const port = await (0, utils_1.readFile)((0, utils_1.getPidPath)(process.ppid));
        (0, client_1.setPort)(port.toString());
    }
    before(caps, specs, browser) {
        this._browser = browser;
        const sharedStore = Object.create({}, {
            get: {
                value: (key) => { var _a; return (_a = this._browser) === null || _a === void 0 ? void 0 : _a.call(() => (0, client_1.getValue)(key)); }
            },
            set: {
                value: (key, value) => { var _a; return (_a = this._browser) === null || _a === void 0 ? void 0 : _a.call(() => (0, client_1.setValue)(key, value)); }
            }
        });
        this._browser.sharedStore = sharedStore;
    }
}
exports.default = SharedStoreService;
