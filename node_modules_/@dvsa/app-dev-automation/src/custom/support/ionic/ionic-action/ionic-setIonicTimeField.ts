import { Selector } from 'webdriverio';
import { formatISO } from 'date-fns';
import checkIfElementExists from '../../../../boilerplate/support/lib/checkIfElementExists';
import { getElementByReference } from '../../../../helpers/element-reference-helper';

/**
 * Perform an click action on the given element
 * @param  {String}   selector Element selector
 */
export default async (
  hours: string,
  minutes: string,
  ampm: string,
  selector: string,
) => {
  /**
     * Get the element selection strategy from the lookup
     * @type {Selector}
     */
  const elementSelector: Selector = getElementByReference(selector);

  let h = parseInt(hours, 10);
  const m = parseInt(minutes, 10);

  if (ampm) {
    // eslint-disable-next-line no-param-reassign
    ampm = ampm.toUpperCase();
    if (ampm === 'PM' && h < 12) h += 12;
    if (ampm === 'AM' && h === 12) h -= 12;
  }

  const timeToSet = formatISO(new Date(2020, 1, 1, h, m));

  await checkIfElementExists(elementSelector);

  await browser.executeScript(`document.querySelector(arguments[0]).value='${timeToSet}'`, [elementSelector]);
};
